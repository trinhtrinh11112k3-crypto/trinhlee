import { useState } from 'react';

interface KetQua {
  coNghiem: boolean;
  nghiemKep?: number;
  nghiem1?: number;
  nghiem2?: number;
  voNghiem?: boolean;
  voSoNghiem?: boolean;
  delta?: number;
  buocGiai: string[];
}

export default function GiaiPhuongTrinhBacHai() {
  const [a, setA] = useState<string>('');
  const [b, setB] = useState<string>('');
  const [c, setC] = useState<string>('');
  const [ketQua, setKetQua] = useState<KetQua | null>(null);
  const [dangTinh, setDangTinh] = useState<boolean>(false);

  const giaiPhuongTrinh = () => {
    setDangTinh(true);
    
    // Giả lập thời gian tính toán
    setTimeout(() => {
      const heSoA = parseFloat(a);
      const heSoB = parseFloat(b);
      const heSoC = parseFloat(c);

      if (isNaN(heSoA) || isNaN(heSoB) || isNaN(heSoC)) {
        alert('Vui lòng nhập đầy đủ các hệ số hợp lệ!');
        setDangTinh(false);
        return;
      }

      const buocGiai: string[] = [];
      buocGiai.push(`Phương trình: ${heSoA}x² + ${heSoB}x + ${heSoC} = 0`);

      // Trường hợp a = 0
      if (heSoA === 0) {
        buocGiai.push('Vì a = 0, đây là phương trình bậc nhất: ' + heSoB + 'x + ' + heSoC + ' = 0');
        
        if (heSoB === 0) {
          if (heSoC === 0) {
            buocGiai.push('Phương trình có vô số nghiệm');
            setKetQua({
              coNghiem: true,
              voSoNghiem: true,
              buocGiai
            });
          } else {
            buocGiai.push('Phương trình vô nghiệm');
            setKetQua({
              coNghiem: false,
              voNghiem: true,
              buocGiai
            });
          }
        } else {
          const nghiem = -heSoC / heSoB;
          buocGiai.push(`Nghiệm: x = -c/b = -${heSoC}/${heSoB} = ${nghiem}`);
          setKetQua({
            coNghiem: true,
            nghiemKep: nghiem,
            buocGiai
          });
        }
        setDangTinh(false);
        return;
      }

      // Tính delta
      const delta = heSoB * heSoB - 4 * heSoA * heSoC;
      buocGiai.push(`Tính delta: Δ = b² - 4ac = ${heSoB}² - 4.${heSoA}.${heSoC} = ${delta}`);

      if (delta < 0) {
        buocGiai.push('Vì Δ < 0, phương trình vô nghiệm');
        setKetQua({
          coNghiem: false,
          voNghiem: true,
          delta,
          buocGiai
        });
      } else if (delta === 0) {
        const nghiem = -heSoB / (2 * heSoA);
        buocGiai.push(`Vì Δ = 0, phương trình có nghiệm kép: x = -b/2a = -${heSoB}/(2.${heSoA}) = ${nghiem}`);
        setKetQua({
          coNghiem: true,
          nghiemKep: nghiem,
          delta,
          buocGiai
        });
      } else {
        const nghiem1 = (-heSoB + Math.sqrt(delta)) / (2 * heSoA);
        const nghiem2 = (-heSoB - Math.sqrt(delta)) / (2 * heSoA);
        buocGiai.push(`Vì Δ > 0, phương trình có 2 nghiệm phân biệt:`);
        buocGiai.push(`x₁ = (-b + √Δ)/2a = (-${heSoB} + √${delta})/(2.${heSoA}) = ${nghiem1}`);
        buocGiai.push(`x₂ = (-b - √Δ)/2a = (-${heSoB} - √${delta})/(2.${heSoA}) = ${nghiem2}`);
        setKetQua({
          coNghiem: true,
          nghiem1,
          nghiem2,
          delta,
          buocGiai
        });
      }
      
      setDangTinh(false);
    }, 500);
  };

  const lamLai = () => {
    setA('');
    setB('');
    setC('');
    setKetQua(null);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-gray-800 mb-2">Giải Phương Trình Bậc 2</h1>
          <p className="text-gray-600">Nhập các hệ số để tìm nghiệm của phương trình ax² + bx + c = 0</p>
        </div>

        <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Hệ số a</label>
              <input
                type="number"
                value={a}
                onChange={(e) => setA(e.target.value)}
                className="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Nhập a"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Hệ số b</label>
              <input
                type="number"
                value={b}
                onChange={(e) => setB(e.target.value)}
                className="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Nhập b"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Hệ số c</label>
              <input
                type="number"
                value={c}
                onChange={(e) => setC(e.target.value)}
                className="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Nhập c"
              />
            </div>
          </div>

          <div className="flex justify-center space-x-4">
            <button
              onClick={giaiPhuongTrinh}
              disabled={dangTinh}
              className="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 disabled:opacity-50"
            >
              {dangTinh ? 'Đang tính...' : 'Giải'}
            </button>
            <button
              onClick={lamLai}
              disabled={dangTinh}
              className="bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400 disabled:opacity-50"
            >
              Làm lại
            </button>
          </div>
        </div>

        {ketQua && (
          <div className="bg-white rounded-2xl shadow-xl p-8">
            <h2 className="text-2xl font-semibold text-gray-800 mb-4">Kết quả</h2>
            <div className="space-y-2">
              {ketQua.buocGiai.map((buoc, index) => (
                <p key={index} className="text-gray-700">
                  {buoc}
                </p>
              ))}
            </div>
            <div className="mt-6">
              {ketQua.coNghiem && ketQua.voSoNghiem && (
                <p className="text-green-600 font-semibold">Phương trình có vô số nghiệm.</p>
              )}
              {ketQua.coNghiem && ketQua.nghiemKep !== undefined && !ketQua.voSoNghiem && (
                <p className="text-green-600 font-semibold">Nghiệm: x = {ketQua.nghiemKep.toFixed(4)}</p>
              )}
              {ketQua.coNghiem && ketQua.nghiem1 !== undefined && ketQua.nghiem2 !== undefined && (
                <>
                  <p className="text-green-600 font-semibold">Nghiệm x₁ = {ketQua.nghiem1.toFixed(4)}</p>
                  <p className="text-green-600 font-semibold">Nghiệm x₂ = {ketQua.nghiem2.toFixed(4)}</p>
                </>
              )}
              {!ketQua.coNghiem && ketQua.voNghiem && (
                <p className="text-red-600 font-semibold">Phương trình vô nghiệm.</p>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
